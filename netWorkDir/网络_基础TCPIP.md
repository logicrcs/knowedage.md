# 	TCP/IP

当前使用的网络都是在tcp/ip协议族的基础上运作的，http就属于它的一个子集TCP/IP是互联网各种协议（protocol）族的统称。

`%3D就是=号`

## 分层

**应用层，传输层，网络层，数据链路层** 

- 分层的优点：

  1. 可维护性：更改时只需要替换改动的层级。

  2. 低耦合：每次的设计变得简单了，处于应用层就可以只考虑  

     分派任务

- 各层的作用：

  **应用层：**决定向用户提供应用服务时通信的活动

  TCP/IP协议族内预存了各种通用的应用协议。HTTP协议就

  处于这层。

  如：FTP(File Transfer Protocol) 文件传输协议

  ​	DNS(Domain Name System) 域名系统服务，**DNS服务**

  ​	与HTTP协议一样处于应用层，提供域名到IP地址解析服务。

  **传输层：**对应上层应用层，提供处于网络连接中的两台计算机之间

  数据传输。存在两个性质不同的协议分别是

  ​	**TCP**(Transmission Control Protocol) 传输控制协议

  ​	**UDP**(User Datagram Protocol) 用户数据报协议

  **网络层：** 用于处理网络上流动的数据包(网络传输的最小数据单位)

  规定通过怎样的路径将数据包传送的对方。IP协议在这层。

  **链路层：**用于处理连接网络的硬件部分。包括

  控制操作系统，硬件的设备驱动，

  NIC(Network interface Card) 网络适配器 即网卡。

  光纤及连接器等一切传播媒介。

  总的来说，硬件均在链路层的作用范围之内。

- TCP/IP在分层中的具体实现（以HTTP协议为例）

  1. 客户机在因应用层(http协议)发出一个web页面的HTTTP请求

  2. `传输层(TCP协议)`接收到来自应用层发来的数据(HTTP请求报文)，将其分割成数据包，并在每个包上打上标记序号

     及端口号转发给网络层。

  3. `网络层(IP协议)`在包上增加最为通信目的地的MAC地址后

     转发给线路层，至此数据包就被封装完毕了。

  4. 客户机在链路层将数据传递出去，而接受端的服务器在链路

     层收到数据。反向走一遍流程最终在应用层接收到HTTP数据。

- **封装：**数据在层与层之间传输数据时，每经过一层被打上这一层

  的首部信息。服务器端就在每一层把对应的首部消去。



##	常用协议

- IP(Internet Protocol)网际协议位于网络层。几乎所有使用网络的系统都使用IP协议

  **IP与IP地址：**IP是一种协议的名称，IP地址是在互联网中确定

  机器身份的地址。指明了节点中被分配到的地址。

  IP地址与MAC地址的区别就是IP地址可更换，而MAC地址基本不会

  更改，因为MAC地址指的是网所属的固定地址，IP地址可以和MAC

  地址进行配对。

  IP协议的作用是把各种数据包传递给对方。同时需要IP地址和

  MAC地址。

- ARP协议(Address Resolution Protocol)

  由于网络上通信双方极少处于同一局域网下，一般是使用多台

  计算机进行中转进行连接。而搜索确定下一个中转设备就使用

  的就是MAC地址。

  ARP协议就是用于解析地址的协议，根据通信方IP地址可以反查 

  出对应的MAC地址。

- TCP协议

  位于传输层，提供可靠的字节流服(Byte Stream Service) 

  TCP协议能够确认数据是否送达。

  由于大段数据在传输途中一旦出错就难以修正。所以将其分割

  成报文段(segment)为单位的数据包进行管理。这样就容易

  实现可靠的传输服务。`TCP首部包含源端口号，目标端口号，序列`

  `号，确认应答号，数据偏移，保留，控制位，窗口大小，校验和，紧急`

  `指针，选项(长度可变)，填充。由于TCP中没有包长和数据长度的字`

  `段，所有都是由IP层获知TCP的包长，再由TCP的包长获取数据长度`

  - 源端口号

    16位

  - 目标端口号
  
    16位
  
  - 序列号
  
    32位，发送数据的位置，发送一次，累加一次
  
    创建连接时由计算机生成的随机数作为初始值，在三次
  
    握手中第一次发送SYN包传给主机，在下一次发送时，将
  
    发送的数据字节数累加到初始值上表示数据的位置。在建
  
    立连接和断开连接时发送的SYN包和FIN包虽然不携带数据，
  
    但也会所谓一个字节增加对应的序列号。
  
  - 确认应答号
  
    32位，下一次应该收到的数据的序列号，实际上是已收
  
    到确认确认应答号减一为止的数据。发送端收到这个确认
  
    应答就可以认为在这个序号以前的数据都已经正常接受了。
  
  - 数据偏移
  
    表示TCP所传输的数据部分应该从TCP包的哪个位开始计算
  
    也可以将其看成TCP首部的长度。这个字段的长是4位，但
  
    是单位是4字节，如果首部是20字节，则这个字段就应该写
  
    5。
  
  - 保留
  
    为以后扩展准备，长度为4位，一般是0，不过即使不是0，
  
    这个包也不会被舍弃。
  
  - 控制位
  
    8位，每一位对应一个含义。TCP协议中几乎所有的操作都
  
    是由控制设置的。
  
  - 窗口大小
  
    16位，通知相同TCP首部的确认应答号所指位置开始能够
  
    接受的数据大小(8位字节)。TCP不允许发送超过所处此处
  
    所示大小的数据。如果窗口为0，就要发送窗口探测，了
  
    解最新窗口大小。
  
  - 校验和
  
    TCP与UDP相似，但是TCP的校验和无法关闭。会使用TCP伪
  
    首部。
  
  - 紧急指针
  
    16位，只有URG控制位为1时有效，该字段的数值表示本报
  
    文端中紧急数据的指针，从数据部分的首位到紧急指针所
  
    指示的位置为止是紧急数据。
  
  - 选项
  
    用于提高TCP的传输性能，根据数据偏移控制，长度最大
  
    为40位。
  
  **三次握手**
  
  1. 发送端先发送一个带有SYN(synchronize)标志的数据包
  
     给接收端。
  
  2. 接受端收到后回传一个带有SYN/ACK标志的数据包表示已 
  
     接受到对应的信息
  
  3. 发送端再回传一个带有ACK标志的数据包代表握手结束。
  
- UDP协议

  UDP是不具有可靠性的数据报协议，细微的处理会交给上层

  的应用去处理。会保证发送消息的大小，但不保证消息会

  送达。不提供复杂的控制机制，利用IP提供面向无连接的
  
  通信服务。是将应用程序发来的数据直接原样发到网络上的
  
  一种机制。`而UDP的首部由源端口号，目标端口号，包长，校验`
  
  `和组成；源端口号字段长16位(2个字节)，能够表示65535个端`
  
  `口号，如果发送不需要应答的消息，就可以将该字段设置为0；`
  
  `目标端口号长度与源端口号一致；包长度保存UDP首部与数据长度`
  
  `之和；校验和使用伪首部来校验UDP是否正确`
  
  所以，即使是出现了网络拥堵，UDP也无法避免网络拥塞的
  
  行为，如果出现丢包，UDP也不负责重发。所有的细节处理
  
  全部交给应用程序。
  
  即，UDP是用户说什么就做什么的机制，就是需要事先考虑
  
  好上层协议类型并制作相应的应用程序。
  
  `实际上，UDP会向接收端发送存有数据长度的数据包，但是`
  
  `只提供传输层协议的最基本功能`
  
  由于UDP面向无连接，可以随时发送数据。UDP本身处理即
  
  简单又高效
  
  1. 包总量较少的通信(DNS,SNMP等)
  2. 视频，音频等多媒体即时通信
  3. 限定于LAN等特定网络中的应用通信
  4. 广播通信(广播，多播。)

### TCP与UDP区分

- TCP是可靠的传输协议，具有面向有连接，具备顺序控制

  重发控制等机制。可谓应用提供可靠传输。

- UDP主要用于对高速传输和实时性有较高要求的通信和广

  播通信。

**IP通话实例：**如果使用TCP，数据在传送途中如果丢失会被重

发，但这样需要验证，就一定对增大通话延迟，无法流畅的传

输声音，而使用UDP，没有重发控制，顺序控制，自然就不用

判断和校验数据包，也就不会有大幅度延迟到达的问题。即使

是由一小部分数据丢失，也只影响一部分通话。就如同实时传

送动画或声音时，途中一小部分网络的丢包可能造成画面或声

音的短暂停顿甚至出现混乱。但在实际使用中这一点干扰并无

大碍。

### 套接字(Socket)

`在使用TCP或UDP中，需要操作系统提供的类库，这种类库一般被称`

`为API(Application Programming Interface,应用编程接口)，`

`使用TCP或UDP是通信时，需要的API就是套接字(socket)，本来是`

`由BSD UNIX开发的，但是后被移植到了Windows的Winsock以及嵌`

`入式操作系统中，应用程序通过套接字设置对端的IP地址，端口号`

`实现数据的发送与接收`



## URI与URL

**URI(Uniform Rsesource Identifier)**统一资源标识符

- Uniform

  规定统一格式方便处理不同类型资源。既不用根据上下文环境

  判断资源的访问方式，也方便了加入新的协议方案。

- Resource

  可标识的任何东西

- Identifier

  可标识的对象。

URI是某种协议方案表示的资源的定位标识符，协议方案就代表资源

访问时使用的名称。HTTP协议对应的协议方案就是http，即

***URI表示的就是某一互联网资源，URL就是资源的地址，URL是***

**URI的子集**

**URL(Uniform Rsesource Locator)**统一资源定位符

URL强调再网络能够定位到这个资源，有点类似于个人住址。而URI

是宏观的能够表示这个资源就行了，无论通过住址还是身份证号，

只要能够表明这个人就行。所以，URL其实是URI这个概念的一种

实现方式。

## 守护进程

在服务器端等待客户端发来请求的程序就是守护进程，系统

会存在一个超级守护进程，在识别请求是发给那个客户端的

时候，创建对应的守护进程。

HTTP的服务器程序就是httpd，SSH的服务端程序是sshd。

## 端口号

数据链路和IP中的地址，分别值MAC地址和IP地址，MAC地址用来

识别同一链路中不同计算机，IP地址用来识别TCP/IP网络中互连

的主机和路由器。在传输层也有类似地址的概念，就是端口号，用

来识别同一台计算机中进行通信的不同应用程序

`因此，被称为程序地址`

### 利用IP地址，端口号，协议号进行通信识别

`TCP/IP或是UDP/IP通信通常采用5个信息来识别，在Unix或Windows`

`系统中可以通过netstat -n查看。`

**源IP地址，目标IP地址，协议号，源端口号，目标端口号**

![netstat -n](C:\Users\Administrator\Desktop\企管处考核系统\knowedage.md\img\网络_基础TCPIP(1·5·1).jpg)

### 端口号的分配

1. 应用程序根据自己的需要指定静态的不改变的端口号。

   如HTTP,FTP这些协议的端口号就是固定的，也被称为

   知名端口号(Well-Known Port Number),这些知名端口号

   一般由0~1023的数字分配而成。除了固定端口号，1024到

   49151之间的端口号就被用于分配个新的需要固定端口号的

   应用程序。

2. 根据时序动态的分配的端口号

   服务器因为需要监听客户端发送的请求，所以需要固定

   的端口号。但是接受服务的客户端就没有必要分配固定

   的端口号。会在49152到65535之间选取端口号。

`但是端口号是传输层的协议，不同的传输协议可以使用相同的`

`端口号，因为对应的协议不同，所以不会有冲突，即，通信识`

`别的5大要素，只要有一个不同就不会冲突`

