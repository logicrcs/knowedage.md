`OSI参考模型的分层对通信中必要的功能做了很好的归纳,但实际上`

`普遍应用的是TCP/IP的四层协议`

# 应用层

`为应用程序提供服务并规定应用程序中通信相关的细节`

包括文件传输，电子邮件，远程登录(虚拟终端)等协议。比如HTTP

就是为WEB应用创立的协议。

# 表示层

`将应用处理的信息转换为适合网络传输的格式(上到下)，或是将来自`

`下一层的数据转换为上层能够处理的格式`

具体来说就是将设备固有的数据格式转换为网络标准传输格式。

比如网卡不仅能够传输HTTP文件也能传输FTP文件，就是基于这种

能够将所有格式转化为标准格式的能力。但在实际中表示层和

应用层都被放在了一起。

# 会话层

`负责建立和断开通信连接(数据流动的逻辑通路)以及数据的分割数据`

`传输相关的管理`

# 传输层

`起着可靠传输的作用，只在通信双方节点上进行处理，无需路由器上`

`处理`TCP就在这一层，

# 网络层

`将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而`

`成的某一个地址。因此这一层主要负责寻址和路由选择。`IP就在这一层

## IP

`公网IP由ICANN管理，在接入网络时，ISP会向用户分配`

`全局IP地址，所以每次重连IP地址就会变化。`

### IPV4

由32位二进制来表示。但人类社会不习惯二进制，所以就将

IP地址每8位一组，分成4组，每组用‘.‘隔开，再将每组转

换成时间指数，就类似192.168.1.1

- 主机可以配置多个网卡
- 路由器可以配置多个IP
- 网卡可以配置多个IP

### IP地址构成

`IP地址是由‘网络标识(网络地址)’和‘主机标识(主机地址)’两`

`部分组成`

- 网络标识：在数据链路的每个段配置不同的值，需要

  保证相互连接的每个端的地址不重复。同一段里的主

  机要有相同的网络地址，而对应主机标识在同一网段

  也不能重复。

- IP包在转发的过程中，正是利用目标IP地址的网络标

  识进行路由

`目前网络标识的位数都是通过子网掩码区分，但确实还存在一`

`种其他类似192.168.144.10/24后面有一个/xx，斜杠后面`

`的数字表示到多少位。在这里就是192.168.144`

### IP地址的分类

- A类地址

  ​	首位以“0”开头，第一位到第八位是网标识，当然，

  去掉分类位就剩下7位；`0.0.0.0~127.0.0.0`就是A类的

  网络地址，`由于网络地址中0.0.0.0和127.0.0.0被保留`

  所以只有126个可用的网络地址，主机地址有24位，即

  一个网段主机上限位16,177,214个。

- B类地址

  ​	前两位是"10",从1~16位是网络标识，去掉分类位

  剩下14位；`128.0.0.1~191.255.0.0`是B类的网络地址，

  因为前两位固定为10，后14位就有16384中，`128.0与`

  `191.255为保留地址，所以B类网络最多有16382个`

  一个网段内主机上限为65,534个。

- C类地址

  ​	前三位为"110"，1~24位是网络标识，192.168

### IP地址的广播

`广播地址用于在同一个链路中相互连接的主机之间发送数据`

#### 如何设置广播地址

将IP地址中的主机地址全部设置为1，就成了广播地址，在以太网

中，如果将MAC地址的所有位改为1，就形成了FF:FF:FF:FF:FF:FF

`自动设置IP地址`

**DHCP(Dynamic Host Configuration Protocol):**能够自动的

设置IP地址，统一管理IP地址分配。

1. 在使用DHCP之前，要先架设DHCP服务器。然后将DHCP所要

   分配的IP地址设置到服务器上，此外还需要将相应的子网

   掩码，路由控制信息以及DNS服务器的地址等设置到服务器上

2. 新接入的设备向数据段内发送DHCP发现包，由于设备的IP还

   没有确定下来，所以源地址是0.0.0.0，表示地址未知

   而发现包的目标地址是255.255.255.255，广播地址，向全

   数据链推送。

3. DHCP服务器可以从事先准备好的IP地址中自动选出进行一

   个分配，也可以针对新设备MAC地址分配固定IP地址。这两种

   方法不互斥，之后将IP等一系列设置放入DHCP提供包中，

   返回DHCP提供包通知新接入的设备可以使用的网络设置

4. 新设备发送DHCP请求包，目标地址与源地址和发现包一致

   通知DHCP服务器希望使用DHCP通知的设置

5. 返回DHCP提供包允许使用设置。此刻DHCP的网络设置结束，

   可以进行TCP/IP通信。

#### 两种广播方式

- 本地广播

  将主机地址全变为1，只能在自己的网段内广播

- 直接广播

  将数据包直接发往目标网段的广播地址，由目标

  网段的路由转发，就能实现不同网络之间的广播。

  但是，直接广播存在一定的安全问题，多数情况

  路由器不转发。

### IP多播

`多播用于将包发送给特定组内的所有主机`

#### 多播地址

`多播使用D类地址，只要IP地址头4位是1110，就可以认为是`

`多播地址，地址中剩下的28位就是组编号`

#### 地址的可用范围

224.0.0.0~239.255.255.255

224.0.0.0~224.0.0.255不需要路由控制。

### 子网掩码

IP地址只要确定分类，就能确定他的用处。但是机械分类就造成了

IP地址的浪费。比如，B类IP网络可以允许6万5千多台计算机，但

实际上基本用不到这个上限，这在无形中就浪费了大量的IP，为此

开发了新的组合方式减少浪费。

#### 子网掩码实现方式

为了减少浪费，也为了环节IP地址的稀缺，人们将地址类别的划分

解绑，`将IP地址中的网络地址全部设成1，将IP地址中的主机地址`

`全部设成0。这样的32位二进制数字就是子网掩码。`使用子网掩码

对照着IP地址，就可以确定那几位是网络地址，哪几位是主机

地址。由此这样的子网掩码就可以自由的定位IP地址的网络标识

长度。`当然子网掩码就是IP首位连续开始1`

#### 子网掩码的表现形式

1. 分两行

IP地址：  172，20，100，52

子网掩码：255，255，255，192

2. 后缀

IP地址：172.20.0.0/16

后面的0可以省略 172.20/26

```http
无线局域网适配器 WLAN:

   连接特定的 DNS 后缀 . . . . . . . : ZYYT
   描述. . . . . . . . . . . . . . . : Intel(R) Dual Band Wireless-AC 7265
   物理地址. . . . . . . . . . . . . : C8-21-58-66-E0-BD
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是
   本地链接 IPv6 地址. . . . . . . . : fe80::f53a:5421:84fc:77be%9(首选)
   IPv4 地址 . . . . . . . . . . . . : 10.96.8.214(首选)
   子网掩码  . . . . . . . . . . . . : 255.255.252.0
   //子网掩码相当于/22
   获得租约的时间  . . . . . . . . . : 2021年6月4日 7:50:37
   租约过期的时间  . . . . . . . . . : 2021年6月4日 15:50:37
   默认网关. . . . . . . . . . . . . : 10.96.8.1
   DHCP 服务器 . . . . . . . . . . . : 10.75.240.186
   DHCPv6 IAID . . . . . . . . . . . : 197665112
   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-27-BF-87-17-FC-45-96-9E-42-8B
   DNS 服务器  . . . . . . . . . . . : 10.75.1.1
                                       10.75.1.2
   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
   
```



### 全局地址和私有地址

`随着全球互联网环境IP地址的稀缺，不能为每一个主机分配一个`

`唯一的IP地址，所以就出现了私有地址。对于没有连接互联网的`

`独立网络中的主机，只需为他分配私有网络中的独立地址。`

#### 私有IP地址范围

- A类

  10.0.0.0~10.255.255.255(10/8)

- B类

  172.16.0.0~172.31.255.255(172.16/12)

- c类

  192.168.0.0~192.168.255.255(192.168/16)

只要在上述范围内的IP地址就是私有IP，其他就是

公网IP。

#### NAT

`能够使配有私有地址的主机和配有全局地址的互联网主机实现通信`

存在应用不能在首部和数据部分直接使用私有地址。

子网掩码和NAT使IPV6没能普及之前，IPV4的解决方案。

- **NAT定义：**NAT(Network Address Translator)是用于

  在本地网络中使用私有地址，在连接互联网时转而使用

  全局IP地址的技术。除转换IP地址外，还出现了可以转

  换TCP，UDP端口号的NAPT(Network Address Ports Translator)技术，由此可以实现全局IP地址与多个主

  机的通信。

- **NAT的工作机制：**当处于内部局域网中的主机A向互

  联网上的主机B发送请求，主机A发出带有自己私有地址及

  目标服务器地址的IP数据包。`数据包在经过NAT路由器时，`

  `NAT路由器就将数据包中的私有地址IP换成公网IP，然后再将`

  `数据包发给目标服务器。在TCP或UDP中，由于IP首部中的IP地`

  `址还要用于校验和的计算，因此当IP地址改变，TCP/UDP首部`

  `也要进行相应地转换，并不仅仅时换个IP地址。在数据包发往`

  `目标服务器的同时，NAT会生成一张地转换的表，在目标服务器`

  `的响应返回时再转发给主机A`。当然，如果局域网中的大量主

  机均需向互联网请求数据，这是NAT服务器就会再地址转换

  的时候改变端口号，从而保证响应得到的数据不会发生冲

  突，不过这个使用就应该叫NAPT了。



### IPV6

IPV4的地址长度为4个8位字节，即32比特，IPV6的地址长度则是

128比特，一般写成8个16位字节，`就是128比特IP地址每16个为`

`一组，每组用冒号(":")隔开，如果出现连续的0则可以将0省略，`

`使用两个冒号("::")隔开，但是，一个IP地址只能出现一次两个`

`的冒号。但是冒号可以省略多段0`

```
fe80::f53a:5421:84fc:77be%9
将省略展开是
fe80:0:0:0:f53a:5421:84fc:77be
```

- IP地址的扩大与路由控制表的聚合

  IP地址依然适应互联网分层构造，分配与其地址结构相适应

  的IP地址，尽可能避免路由表膨大。

- 性能提升

  包首部长度采用固定的值

- 支持即插即用功能

  即使没有DHCP服务器也可以实现自动分配IP地址

- 采用认证和加密功能

  应对伪造IP地址的网络安全功能以及防止线路窃听的功能(IPsec)

- 多播，Mobile IP 被定义位IPV6的扩展功能，

#### 全局单播地址

`由48位全局路由前缀，16位子网ID，64位接口ID组成`

其中，接口ID统称保存64位版的MAC地址的值，MAC地址一般48位，

不过MAC地址可能不希望让对端知道，所以也可以产生一个临时的

随机地址，定期更新，所以IPV6查看定位设备就变得不那么简单。

#### 链路本地单播地址

`是同一个数据链路内唯一的地址，不经过路由器，有十位（1111111010）`

`，54位的0，和64位的MAC地址`

#### 唯一本地地址

`是不进行互联网通信时所使用的地址`

**构成：**

- 7位的1111110；
- 1位的L，一般被设为1；
- 40位的全局ID，生成的随机全局ID
- 16位的子网ID
- 64位的接口ID

#### NAT-PT(NAPT-PT)

`将IPV6的首部转换为IPV4的首部的一种技术，能够使IPV6主机`

`IPV4主机通信`

- NAT的潜在问题

  1. 无法从NAT的外部向内部服务器建立连接可以开放

     端口，但数量还是受限于全局IP地址的个数

  2. 转换表的生成与转换操作一定会产生开销

  3. 通信过程一旦NAT遇到异常需要重新启动时

     所有TCP连接都将被重置

  4. 即使备置两台NAT做容灾备份，TCP连接还是会断开

- 解决NAT的潜在问题和NAT穿越

  1. 改用IPV6

     但是目前IPV6的普及程度远不及预期

  2. 由应用与NAT路由器进行通信生成NAT表，并通过

     一定的方法将NAT路由器上附属的全局IP地址传给

     应用。先是让NAT生成对应的转换表，这样外界就

     能正常穿透了。

### IP隧道

`一般而言，紧接着IP首部的是TCP或UDP的首部，但是，如果在IP`

`首部的后面还是IP首部，或者IPV4首部的后面是IPV6的首部，这`

`种在网络层首部后面继续追加网络层首部的通信方法就是IP隧道`





# 数据链路

`负责物理层面上互连的，节点之间的通信传输`例如与1个以太网相连

2个节点之间的通信。

​	将0，1序列划分为具有意义的数据帧传送给对端(数据帧的

生成与接受)

**协议：**定义了通过通信媒介互连的设备之间传输的规范。

## MAC地址

​	`MAC地址用于识别数据链路中互连的节点，MAC地址规范没有`

`限定数据链路类型，不管哪种数据链路的网络(以太网，FDDI,ATM`

`无线LAN,蓝牙)，都不会出现相同MAC地址`

**MAC地址构成：**MAC地址长48位，在这48个bit之中，含义如下

- 第一位：单播地址(0)/多播地址(1)

- 第二位：全局地址(0)/本地地址(1)

- 第3~24位：厂商识别码，每一个NIC厂商都有唯一的

  识别数字，由IEEE管理保证每个厂家的不重复。

- 第25~48位：厂商内部为识别每个网卡使用，有厂商

  保证之间不重复。

`但是在显示的过程中一般为了方便查看，就将MAC地址转化为`

`16进制查看`

```
C:\Users\Administrator>ipconfig/all

Windows IP 配置

   主机名  . . . . . . . . . . . . . : PC-20210218IXTW
   主 DNS 后缀 . . . . . . . . . . . :
   节点类型  . . . . . . . . . . . . : 混合
   IP 路由已启用 . . . . . . . . . . : 否
   WINS 代理已启用 . . . . . . . . . : 否
   DNS 后缀搜索列表  . . . . . . . . : ZYYT

以太网适配器 以太网:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Realtek PCIe GbE Family Controller
   物理地址. . . . . . . . . . . . . : FC-45-96-9E-42-8B
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 本地连接* 9:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
   物理地址. . . . . . . . . . . . . : C8-21-58-66-E0-BE
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter #2
   物理地址. . . . . . . . . . . . . : CA-21-58-66-E0-BD
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 WLAN:

   连接特定的 DNS 后缀 . . . . . . . : ZYYT
   描述. . . . . . . . . . . . . . . : Intel(R) Dual Band Wireless-AC 7265
   物理地址. . . . . . . . . . . . . : C8-21-58-66-E0-BD
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是
   本地链接 IPv6 地址. . . . . . . . : fe80::f53a:5421:84fc:77be%9(首选)
   IPv4 地址 . . . . . . . . . . . . : 10.96.8.153(首选)
   子网掩码  . . . . . . . . . . . . : 255.255.252.0
   获得租约的时间  . . . . . . . . . : 2021年6月2日 14:27:32
   租约过期的时间  . . . . . . . . . : 2021年6月3日 0:58:05
   默认网关. . . . . . . . . . . . . : 10.96.8.1
   DHCP 服务器 . . . . . . . . . . . : 10.75.240.186
   DHCPv6 IAID . . . . . . . . . . . : 197665112
   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-27-BF-87-17-FC-45-96-9E-42-8B
   DNS 服务器  . . . . . . . . . . . : 10.75.1.1
                                       10.75.1.2
   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
```

FC-45-96-9E-42-8B 换算成真实的MAC地址是

11111100(FC)01000101(45)10010110(96)10011110(9E)-

-01000010(42)10001011(8B)

可以将16进制直接1位折换4位的转化为16位

0-0000，1-0001，2-0010，3-0011，

4-0100，5-0101，6-0110，7-0111，

8-1000，9-1001，A-1010,B-1011,

C-1100,D-1101,E-1110,F-1111。

https://mac.bmcx.com/ `可以根据这个网址查询`

**例外：**如果一个主机启动多个虚拟机，每个虚拟机就会有一个

虚拟网卡，这是很难保证MAC地址独一无二。

## 以太网交换机运作方式

根据`数据链路层中每个帧的目标MAC地址`，决定从那个网络接口发送数据

参考转发表，但是转发表的内容不需要手动设置，可以自动生成。数

据链路层每个通过点在接到包时，会将`源MAC地址(即发送方地址)与对`

`应的目标接口`作为对应关系放入转发表中，即，该MAC地址就是该接

口的目标。以该MAC地址最为目标地址的包，就有该接口送出即可，这

就是自学。换做通俗的话表示

***

*主机A通过端口1与交换机连接，**这时交换机还不知道主机A***

***连在了端口1上**，当主机A向其他主机传递数据时，**交换机***

***这时才根据主机A的数据包确定了主机A与端口1相连，***

***数据包有发送主机的MAC地址，并且是从端口1发来的，现在***

***交换机就将MAC地址A与端口1对应关系写入转发表**，这样交换*

*机就知道了以后只要有发完MAC地址A的数据包就给端口1送过去*

***

但是由于MAC地址没有层次无法包含多层地址，那么如果一个数据

链路中的网络设备过多，检索转发表的时间就会极大的影响效率。

所以，就有必要将网络分成多个数据链路。采用类似网络层的IP地址

一样对地址进行分层管理。

### 交换机转发方式

- 存储转发

  检查以太网数据帧末尾的FCS位之后转发，能够防止

  发送错误帧

- 直通转发

  不需要整个帧全部接受下来，只需要知道目标地址就

  开始转发。 传输的延迟较短，但有可能发送错误帧。

## 以太网

计算机采用二进制就是1K=1024，1M=1024K,1G=1024M

但在以太网中，`是以时钟频率决定传输速度，就不受限于二`

`进制了，所以1K=1000，以此类推。`

## 以太网帧格式

### 前导码(Preamble)

`以太网帧前端有一个叫做前导码的部分，表示一个以太网帧的开始`

`，也是对端网卡能够确保与其同步的标志。`

1. 长度为8个字节

2. 末尾最后一个字节是一个SFD(Start Frame Delimiter)

   的域

3. 前导码之后就是以太网帧的本体

### 以太网的首部

`以太网帧的本体的前端是以太网的首部，包含6个字节的目标MAC地址`

`，6个字节的源MAC地址，2个字节的上层协议类型共14个字节。`

- 在帧这两个字节的数值类型这里，存在不同的展现形式。

  在802.3中变成了，帧长度，LLC和SNAP，其中，SNAP存放

  着，数值类型。

- 但以太网数据帧尾部会固定的有一个FCS校验所用的数据帧。

## 无线LAN

MIMO(Multiple-Input Multiple-Output,多入多出技术)

2.4GHz频段系统由于用户太多，微波炉都使用，导致速度有

问题。





# 物理层

`负责0，1比特流与电压的高低，光的闪灭之间的互换`