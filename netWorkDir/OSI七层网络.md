`OSI参考模型的分层对通信中必要的功能做了很好的归纳,但实际上`

`普遍应用的是TCP/IP的四层协议`

# 应用层

`为应用程序提供服务并规定应用程序中通信相关的细节`

包括文件传输，电子邮件，远程登录(虚拟终端)等协议。比如HTTP

就是为WEB应用创立的协议。

# 表示层

`将应用处理的信息转换为适合网络传输的格式(上到下)，或是将来自`

`下一层的数据转换为上层能够处理的格式`

具体来说就是将设备固有的数据格式转换为网络标准传输格式。

比如网卡不仅能够传输HTTP文件也能传输FTP文件，就是基于这种

能够将所有格式转化为标准格式的能力。但在实际中表示层和

应用层都被放在了一起。

# 会话层

`负责建立和断开通信连接(数据流动的逻辑通路)以及数据的分割数据`

`传输相关的管理`

# 传输层

`起着可靠传输的作用，只在通信双方节点上进行处理，无需路由器上`

`处理`TCP就在这一层，

# 网络层

`将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而`

`成的某一个地址。因此这一层主要负责寻址和路由选择。`IP就在这一层

## IP

`公网IP由ICANN管理，在接入网络时，ISP会向用户分配`

`全局IP地址，所以每次重连IP地址就会变化。`

### IPV4

由32位二进制来表示。但人类社会不习惯二进制，所以就将

IP地址每8位一组，分成4组，每组用‘.‘隔开，再将每组转

换成时间指数，就类似192.168.1.1

- 主机可以配置多个网卡
- 路由器可以配置多个IP
- 网卡可以配置多个IP

### IP地址构成

`IP地址是由‘网络标识(网络地址)’和‘主机标识(主机地址)’两`

`部分组成`

- 网络标识：在数据链路的每个段配置不同的值，需要

  保证相互连接的每个端的地址不重复。同一段里的主

  机要有相同的网络地址，而对应主机标识在同一网段

  也不能重复。

- IP包在转发的过程中，正是利用目标IP地址的网络标

  识进行路由

`目前网络标识的位数都是通过子网掩码区分，但确实还存在一`

`种其他类似192.168.144.10/24后面有一个/xx，斜杠后面`

`的数字表示到多少位。在这里就是192.168.144`

### IP地址的分类

- A类地址

  ​	首位以“0”开头，第一位到第八位是网标识，当然，

  去掉分类位就剩下7位；`0.0.0.0~127.0.0.0`就是A类的

  网络地址，`由于网络地址中0.0.0.0和127.0.0.0被保留`

  所以只有126个可用的网络地址，主机地址有24位，即

  一个网段主机上限位16,177,214个。

- B类地址

  ​	前两位是"10",从1~16位是网络标识，去掉分类位

  剩下14位；`128.0.0.1~191.255.0.0`是B类的网络地址，

  因为前两位固定为10，后14位就有16384中，`128.0与`

  `191.255为保留地址，所以B类网络最多有16382个`

  一个网段内主机上限为65,534个。

- C类地址

  ​	前三位为"110"，1~24位是网络标识，192.168

### IP地址的广播

`广播地址用于在同一个链路中相互连接的主机之间发送数据`

#### 如何设置广播地址

将IP地址中的主机地址全部设置为1，就成了广播地址，在以太网

中，如果将MAC地址的所有位改为1，就形成了FF:FF:FF:FF:FF:FF

#### 两种广播方式

- 本地广播

  将主机地址全变为1，只能在自己的网段内广播

- 直接广播

  将数据包直接发往目标网段的广播地址，由目标

  网段的路由转发，就能实现不同网络之间的广播。

  但是，直接广播存在一定的安全问题，多数情况

  路由器不转发。

### IP多播

`多播用于将包发送给特定组内的所有主机`

#### 多播地址

`多播使用D类地址，只要IP地址头4位是1110，就可以认为是`

`多播地址，地址中剩下的28位就是组编号`

#### 地址的可用范围

224.0.0.0~239.255.255.255

224.0.0.0~224.0.0.255不需要路由控制。

### 子网掩码

IP地址只要确定分类，就能确定他的用处。但是机械分类就造成了

IP地址的浪费。比如，B类IP网络可以允许6万5千多台计算机，但

实际上基本用不到这个上限，这在无形中就浪费了大量的IP，为此

开发了新的组合方式减少浪费。

#### 子网掩码实现方式

为了减少浪费，也为了环节IP地址的稀缺，人们将地址类别的划分

解绑，`将IP地址中的网络地址全部设成1，将IP地址中的主机地址`

`全部设成0。这样的32位二进制数字就是子网掩码。`使用子网掩码

对照着IP地址，就可以确定那几位是网络地址，哪几位是主机

地址。由此这样的子网掩码就可以自由的定位IP地址的网络标识

长度。`当然子网掩码就是IP首位连续开始1`

#### 子网掩码的表现形式

1. 分两行

IP地址：  172，20，100，52

子网掩码：255，255，255，192

2. 后缀

IP地址：172.20.0.0/16

后面的0可以省略 172.20/26

### 全局地址和私有地址

`随着全球互联网环境IP地址的稀缺，不能为每一个主机分配一个`

`唯一的IP地址，所以就出现了私有地址。对于没有连接互联网的`

`独立网络中的主机，只需为他分配私有网络中的独立地址。`

#### 私有IP地址范围

- A类

  10.0.0.0~10.255.255.255(10/8)

- B类

  172.16.0.0~172.31.255.255(172.16/12)

- c类

  192.168.0.0~192.168.255.255(192.168/16)

只要在上述范围内的IP地址就是私有IP，其他就是

公网IP。

#### NAT

`能够使配有私有地址的主机和配有全局地址的互联网主机实现通信`

存在应用不能在首部和数据部分直接使用私有地址。

子网掩码和NAT使IPV6没能普及之前，IPV4的解决方案。

# 数据链路

`负责物理层面上互连的，节点之间的通信传输`例如与1个以太网相连

2个节点之间的通信。

​	将0，1序列划分为具有意义的数据帧传送给对端(数据帧的

生成与接受)

**协议：**定义了通过通信媒介互连的设备之间传输的规范。

## MAC地址

​	`MAC地址用于识别数据链路中互连的节点，MAC地址规范没有`

`限定数据链路类型，不管哪种数据链路的网络(以太网，FDDI,ATM`

`无线LAN,蓝牙)，都不会出现相同MAC地址`

**MAC地址构成：**MAC地址长48位，在这48个bit之中，含义如下

- 第一位：单播地址(0)/多播地址(1)

- 第二位：全局地址(0)/本地地址(1)

- 第3~24位：厂商识别码，每一个NIC厂商都有唯一的

  识别数字，由IEEE管理保证每个厂家的不重复。

- 第25~48位：厂商内部为识别每个网卡使用，有厂商

  保证之间不重复。

`但是在显示的过程中一般为了方便查看，就将MAC地址转化为`

`16进制查看`

```
C:\Users\Administrator>ipconfig/all

Windows IP 配置

   主机名  . . . . . . . . . . . . . : PC-20210218IXTW
   主 DNS 后缀 . . . . . . . . . . . :
   节点类型  . . . . . . . . . . . . : 混合
   IP 路由已启用 . . . . . . . . . . : 否
   WINS 代理已启用 . . . . . . . . . : 否
   DNS 后缀搜索列表  . . . . . . . . : ZYYT

以太网适配器 以太网:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Realtek PCIe GbE Family Controller
   物理地址. . . . . . . . . . . . . : FC-45-96-9E-42-8B
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 本地连接* 9:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
   物理地址. . . . . . . . . . . . . : C8-21-58-66-E0-BE
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter #2
   物理地址. . . . . . . . . . . . . : CA-21-58-66-E0-BD
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 WLAN:

   连接特定的 DNS 后缀 . . . . . . . : ZYYT
   描述. . . . . . . . . . . . . . . : Intel(R) Dual Band Wireless-AC 7265
   物理地址. . . . . . . . . . . . . : C8-21-58-66-E0-BD
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是
   本地链接 IPv6 地址. . . . . . . . : fe80::f53a:5421:84fc:77be%9(首选)
   IPv4 地址 . . . . . . . . . . . . : 10.96.8.153(首选)
   子网掩码  . . . . . . . . . . . . : 255.255.252.0
   获得租约的时间  . . . . . . . . . : 2021年6月2日 14:27:32
   租约过期的时间  . . . . . . . . . : 2021年6月3日 0:58:05
   默认网关. . . . . . . . . . . . . : 10.96.8.1
   DHCP 服务器 . . . . . . . . . . . : 10.75.240.186
   DHCPv6 IAID . . . . . . . . . . . : 197665112
   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-27-BF-87-17-FC-45-96-9E-42-8B
   DNS 服务器  . . . . . . . . . . . : 10.75.1.1
                                       10.75.1.2
   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
```

FC-45-96-9E-42-8B 换算成真实的MAC地址是

11111100(FC)01000101(45)10010110(96)10011110(9E)-

-01000010(42)10001011(8B)

可以将16进制直接1位折换4位的转化为16位

0-0000，1-0001，2-0010，3-0011，

4-0100，5-0101，6-0110，7-0111，

8-1000，9-1001，A-1010,B-1011,

C-1100,D-1101,E-1110,F-1111。

https://mac.bmcx.com/ `可以根据这个网址查询`

**例外：**如果一个主机启动多个虚拟机，每个虚拟机就会有一个

虚拟网卡，这是很难保证MAC地址独一无二。

## 以太网交换机运作方式

根据`数据链路层中每个帧的目标MAC地址`，决定从那个网络接口发送数据

参考转发表，但是转发表的内容不需要手动设置，可以自动生成。数

据链路层每个通过点在接到包时，会将`源MAC地址(即发送方地址)与对`

`应的目标接口`作为对应关系放入转发表中，即，该MAC地址就是该接

口的目标。以该MAC地址最为目标地址的包，就有该接口送出即可，这

就是自学。换做通俗的话表示

***

*主机A通过端口1与交换机连接，**这时交换机还不知道主机A***

***连在了端口1上**，当主机A向其他主机传递数据时，**交换机***

***这时才根据主机A的数据包确定了主机A与端口1相连，***

***数据包有发送主机的MAC地址，并且是从端口1发来的，现在***

***交换机就将MAC地址A与端口1对应关系写入转发表**，这样交换*

*机就知道了以后只要有发完MAC地址A的数据包就给端口1送过去*

***

但是由于MAC地址没有层次无法包含多层地址，那么如果一个数据

链路中的网络设备过多，检索转发表的时间就会极大的影响效率。

所以，就有必要将网络分成多个数据链路。采用类似网络层的IP地址

一样对地址进行分层管理。

### 交换机转发方式

- 存储转发

  检查以太网数据帧末尾的FCS位之后转发，能够防止

  发送错误帧

- 直通转发

  不需要整个帧全部接受下来，只需要知道目标地址就

  开始转发。 传输的延迟较短，但有可能发送错误帧。

## 以太网

计算机采用二进制就是1K=1024，1M=1024K,1G=1024M

但在以太网中，`是以时钟频率决定传输速度，就不受限于二`

`进制了，所以1K=1000，以此类推。`

## 以太网帧格式

### 前导码(Preamble)

`以太网帧前端有一个叫做前导码的部分，表示一个以太网帧的开始`

`，也是对端网卡能够确保与其同步的标志。`

1. 长度为8个字节

2. 末尾最后一个字节是一个SFD(Start Frame Delimiter)

   的域

3. 前导码之后就是以太网帧的本体

### 以太网的首部

`以太网帧的本体的前端是以太网的首部，包含6个字节的目标MAC地址`

`，6个字节的源MAC地址，2个字节的上层协议类型共14个字节。`

- 在帧这两个字节的数值类型这里，存在不同的展现形式。

  在802.3中变成了，帧长度，LLC和SNAP，其中，SNAP存放

  着，数值类型。

- 但以太网数据帧尾部会固定的有一个FCS校验所用的数据帧。

## 无线LAN

MIMO(Multiple-Input Multiple-Output,多入多出技术)

2.4GHz频段系统由于用户太多，微波炉都使用，导致速度有

问题。





# 物理层

`负责0，1比特流与电压的高低，光的闪灭之间的互换`